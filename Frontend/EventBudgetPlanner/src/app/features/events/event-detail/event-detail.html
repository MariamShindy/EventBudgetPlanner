<div class="event-detail-container" *ngIf="!isLoading && event; else loadingTemplate">
  <header>
    <div>
      <h2>{{ event?.name }}</h2>
      <p>{{ event?.date | date: 'fullDate' }}</p>
    </div>
    <div class="header-actions">
      <button class="btn secondary" (click)="shareToWhatsApp()">Share Event</button>
      <button class="btn primary" (click)="editEvent()">Edit Event</button>
      <button class="btn danger" (click)="deleteEvent()">Delete Event</button>
    </div>
  </header>

  <section class="event-info">
    <div class="card">
      <h3>Budget Info</h3>
      <div class="info-grid">
        <div>
          <label>Total Budget</label>
          <span>{{ event?.budget | currency }}</span>
        </div>
        <div>
          <label>Created</label>
          <span>{{ event?.createdDate | date: 'short' }}</span>
        </div>
        <div>
          <label>Description</label>
          <span>{{ event?.description || 'No description provided.' }}</span>
        </div>
      </div>
    </div>

    <div class="card" *ngIf="summary">
      <h3>Summary</h3>
      <div class="summary-grid">
        <div>
          <label>Total Spent</label>
          <span>{{ summary.totalSpent | currency }}</span>
        </div>
        <div>
          <label>Remaining</label>
          <span>{{ summary.remainingBudget | currency }}</span>
        </div>
        <div>
          <label>Spent (%)</label>
          <span>{{ summary.percentageSpent | number: '1.0-2' }}%</span>
        </div>
        <div>
          <label>Expenses</label>
          <span>{{ summary.totalExpensesCount }} total</span>
        </div>
      </div>
      <div class="categories">
        <h4>Expenses by Category</h4>
        <div class="category" *ngFor="let category of summary.expensesByCategory | keyvalue">
          <span>{{ category.key }}</span>
          <strong>{{ category.value | currency }}</strong>
        </div>
      </div>
    </div>

    <div class="card" *ngIf="cashflow">
      <h3>Cashflow ({{ cashflow.interval | titlecase }})</h3>
      <div class="cashflow">
        <div class="point" *ngFor="let point of cashflow.points">
          <div>
            <label>{{ point.periodStart | date: 'MMM d' }} - {{ point.periodEnd | date: 'MMM d' }}</label>
            <span>{{ point.total | currency }}</span>
          </div>
          <small>Cumulative: {{ point.cumulative | currency }}</small>
        </div>
      </div>
    </div>

    <div class="card" *ngIf="shareLink">
      <h3>Share Link</h3>
      <p>{{ shareLink }}</p>
    </div>

    <!-- Expenses Section -->
    <div class="card">
      <div class="card-header">
        <h3>Expenses</h3>
        <button class="btn primary" (click)="router.navigate(['/events', event.id, 'expenses', 'create'])">
          Add Expense
        </button>
      </div>

      <!-- Expense Filters -->
      <div class="expense-filters">
        <select [(ngModel)]="expenseFilter.paid" (change)="filterExpenses()">
          <option [ngValue]="null">All Payment Status</option>
          <option [ngValue]="true">Paid</option>
          <option [ngValue]="false">Unpaid</option>
        </select>
        <input 
          type="text" 
          [(ngModel)]="expenseFilter.category" 
          (input)="filterExpenses()"
          placeholder="Filter by category">
        <button class="btn secondary" (click)="clearExpenseFilters()">Clear Filters</button>
      </div>

      <!-- Expenses List -->
      <div *ngIf="expensesLoading" class="loading">Loading expenses...</div>
      <div *ngIf="!expensesLoading && filteredExpenses.length === 0" class="empty-state">
        <p>No expenses found. Add your first expense to get started!</p>
      </div>
      <div class="expenses-list" *ngIf="!expensesLoading && filteredExpenses.length > 0">
        <div class="expense-item" *ngFor="let expense of filteredExpenses">
          <div class="expense-info">
            <div class="expense-main">
              <h4>{{ expense.category }}</h4>
              <span class="expense-amount">{{ expense.amount | currency }}</span>
            </div>
            <div class="expense-details">
              <p *ngIf="expense.description">{{ expense.description }}</p>
              <small>{{ expense.date | date: 'short' }}</small>
            </div>
          </div>
          <div class="expense-actions">
            <label class="paid-toggle">
              <input 
                type="checkbox" 
                [checked]="expense.paid"
                (change)="toggleExpensePaidStatus(expense)">
              <span>{{ expense.paid ? 'Paid' : 'Unpaid' }}</span>
            </label>
            <button class="btn secondary" (click)="router.navigate(['/events', event.id, 'expenses', expense.id, 'edit'])">
              Edit
            </button>
            <button class="btn danger" (click)="deleteExpense(expense.id)">Delete</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Reminder Section -->
    <div class="card">
      <div class="card-header">
        <h3>Email Reminders</h3>
        <button class="btn secondary" (click)="showReminderForm = !showReminderForm">
          {{ showReminderForm ? 'Cancel' : 'Send Reminder' }}
        </button>
      </div>

      <div *ngIf="reminderSuccess" class="success-message">
        Reminder sent successfully!
      </div>

      <form *ngIf="showReminderForm" (ngSubmit)="sendReminder()" class="reminder-form">
        <div class="form-group">
          <label>Email Address</label>
          <input 
            type="email" 
            [(ngModel)]="reminderForm.email" 
            name="email"
            required
            placeholder="recipient@example.com">
        </div>
        <div class="form-group">
          <label>Days Before Event</label>
          <input 
            type="number" 
            [(ngModel)]="reminderForm.daysBeforeEvent" 
            name="daysBeforeEvent"
            min="1"
            required>
        </div>
        <div class="form-group">
          <label>Custom Message (Optional)</label>
          <textarea 
            [(ngModel)]="reminderForm.customMessage" 
            name="customMessage"
            rows="3"
            placeholder="Add a custom message to the reminder email"></textarea>
        </div>
        <button type="submit" class="btn primary">Send Reminder</button>
      </form>
    </div>
  </section>
</div>

<ng-template #loadingTemplate>
  <div class="loading">Loading event...</div>
</ng-template>